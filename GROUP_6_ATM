import random
import time

class Transactiondetails:
    def __init__(self, amount, transtype):
        self.amount = amount
        self.transtype = transtype


class Account:
    def __init__(self, username, password, accountbalance, accountpin, transactions, max_history):
        self.username = username
        self.password = password
        self.accountbalance = accountbalance
        self.accountpin = accountpin
        self.transactions = []
        self.max_history = max_history

    def save_trans(self, Transactiondetails):
        if len(self.transactions) >= self.max_history:
            del self.transactions[0:2]
            self.transactions.append(Transactiondetails)
        else:
            self.transactions.append(Transactiondetails)


class Acclist:
    def __init__(self, max_acc):
        self.max_acc = max_acc
        self.accounts = []

    def save_acc(self, Account):
        if len(self.accounts) < self.max_acc:
            self.accounts.append(Account)
            return True
        return False


# The menu the user will see when they open the program

def StartMenu():
    global currentaccount
    currentaccount = -1

    print('\n')

    while True:
        print('Hello User')
        Menu = input('Enter y to start the program')

        if Menu == 'y':
            UserProgram()
        else:
            print('Invalid Option')
            continue


# The menu that allows the user to log in or sign up

def UserProgram():
    global Accountlist

    print('\n')

    print('Enter C to [CREATE NEW ACCOUNT]')
    print('Enter V to [LOGIN TO EXISTING ACCOUNT]')
    print('Enter B to [RETURN TO MAIN MENU]')

    Option = input('[ENTER YOUR OPTION]...').capitalize()

    if Option == 'C':
        AccountCreation()
    elif Option == 'B':
        StartMenu()
    elif Option == 'V':
        if len(Accountlist.accounts) < 1:
            print('[NO ACCOUNTS AVAILABLE]')
            print('[CREATE AN ACCOUNT]')
            print('...')
            AccountCreation()

        else:
            print('[LOGIN TO ACCESS ACCOUNT]')
            print('...')
            LogIn()
    else:
        print('[INVALID OPTION!]...')
        print('[BACK TO MENU]')
        StartMenu()


# The menu to create an account

def AccountCreation():
    global namehold
    global passhold
    global Accountlist


    print('\n')

    if len(Accountlist.accounts) == Accountlist.max_acc:
        print('[MAX ACCOUNT REACHED]')
        print('[RETURNING TO MENU]')
        print('[...]')
        UserProgram()
    else:
        while True:
            NameExists = False
            NewUsername = input('[PLEASE ENTER AN ACCOUNT USERNAME]: ')
            i = 0

            for Account in Accountlist.accounts:
                if NewUsername == Accountlist.accounts[i].username:
                    NameExists = True
                    # nya neko nya change 1

                else:
                    i+=1


            if NameExists == True:
                print('[NAME IN USE, TRY AGAIN]')
                print('[...]')
                continue

            else:
                print('[USERNAME ACCEPTED]')
                NewPassword = input('[ENTER PASSWORD]: ')
                ConfirmPassword = input('[CONFIRM PASSWORD]: ')

                if NewPassword == ConfirmPassword:
                    print('[ACCOUNT CREATED!]')
                    print('[...]')
                    namehold = NewUsername
                    passhold = ConfirmPassword
                    Setpin()

                else:
                    print('[PASSWORD DOES NOT MATCH]')
                    print('[...]')
                    continue


# The menu to make an account pin

def Setpin():
    global pinhold
    digits = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']

    print('\n')

    while True:
        number = 0

        NewPin = input('[ENTER 4-DIGIT PIN]: ')
        for i in NewPin:
            if i in digits and len(NewPin) == 4:
                number += 1
            else:
                pass

        if number == 4:
            print('[PIN UPDATED]')
            pinhold = NewPin
            SaveAccount()

        else:
            print('[ENTER 4-DIGIT NUMBER]')
            print('[...]')
            continue


# The function that saves the account

def SaveAccount():
    global currentaccount
    global balancehold

    print('\n')

    balancehold = random.randint(1000, 100000)
    print(f'YOUR UNCLE SENT YOU [{balancehold}] ðŸ˜˜')
    print('[...]')

    Acc0 = Account(namehold, passhold, balancehold, pinhold, [], 5)

    Accountlist.save_acc(Acc0)
    currentaccount = Accountlist.accounts.index(Acc0)

    print(f'[{str(Accountlist.accounts[currentaccount].username).capitalize()}], YOU NOW HAVE [â‚¦{Accountlist.accounts[currentaccount].accountbalance}]')
    print('...')
    print('...')

    LoggedIn()


# The menu that allows the user to log in to an existing account

def LogIn():
    global currentaccount

    print('\n')

    while True:
        AccountExists = False
        CheckUsername = input('[ENTER ACCOUNT USERNAME]: ')

        h = 0
        for Account in Accountlist.accounts:
            if CheckUsername == Accountlist.accounts[h].username:
                AccountExists = True
            else:
                h += 1

        if AccountExists == True:
            CheckPassword = input('[ENTER PASSWORD]: ')
            if CheckPassword == Accountlist.accounts[h].password:
                print('[LOGIN SUCCESSFUL!!]')
                print('[...]')
                currentaccount = h
                LoggedIn()

            else:
                print('[INVALID PASSWORD START AGAIN]')
                print('...')
                continue

        else:
            print('[ACCOUNT DOES NOT EXSIT]')
            print('[...]')
            UserProgram()


# The menu that the user sees when they log in

def LoggedIn():
    global currentaccount

    print('\n')

    while True:
        print(f'HELLO [{str(Accountlist.accounts[currentaccount].username).capitalize()}]\n')
        print('What would you like to do today?'.capitalize())
        print('[...]')
        print('Enter C to [CHECK ACCOUNT DETAILS]')
        print('Enter V to [CHANGE PASSWORD]')
        print('Enter S to [CHANGE PIN]')
        print('[...]')
        print('Enter B to [CHECK ACCOUNT BALANCE]')
        print('Enter H to [CHECK TRANSACTION HISTORY]')
        print('Enter M to [DEPOSIT OR WITHDRAW]')
        print('...')
        print('Enter J to [DELETE ACCOUNT]')
        print('Enter X to [LOG OUT]')

        Option = input('[ENTER OPTION]...').capitalize()
        if Option == 'C':
            DetailsCheck()
        elif Option == 'V':
            PasswordUpdate()
        elif Option == 'X':
            StartMenu()
        elif Option == 'S':
            PinUpdate()
        elif Option == 'B':
            Checkbalance()
        elif Option == 'M':
            MoneyMenu()
        elif Option == 'H':
            Transaction_history()
        elif Option == 'J':
            DeleteAcc()
        else:
            print('[INVALID OPTION]')
            continue


# A function that shows the user their account details

def DetailsCheck():
    global currentaccount

    print('\n')

    print(f'[USERNAME] =  [{str(Accountlist.accounts[currentaccount].username).capitalize()}]')
    print(f'[PASSWORD] =  [{int(Accountlist.accounts[currentaccount].password)}]')
    print(f'[PIN] =  [{int(Accountlist.accounts[currentaccount].accountpin)}]')
    print('[...]')

    LoggedIn()


# A function that allows the user to change their password

def PasswordUpdate():
    global currentaccount

    print('\n')

    CheckPassword = input('[CONFIRM ACCOUNT PASSWORD]: ')
    if CheckPassword == Accountlist.accounts[currentaccount].password:
        NewPassword = input('[ENTER NEW PASSWORD]: ')
        ConfirmPassword = input('[CONFIRM PASSWORD]: ')

        if NewPassword == ConfirmPassword:
            print('[PASSWORD UPDATED]')
            Accountlist.accounts[currentaccount].password = ConfirmPassword

        else:
            print('[PASSWORD DOES NOT MATCH]')
            LoggedIn()

    else:
        print('[INCORRECT PASSWORD]')
        LoggedIn()


# A function that allows the user to change their PIN

def PinUpdate():
    global currentaccount
    digits = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']

    print('\n')

    while True:
        number = 0

        CheckPassword = input('[CONFIRM ACCOUNT PASSWORD]: ')
        if CheckPassword == Accountlist.accounts[currentaccount].password:
            while True:
                NewPin = input('[ENTER NEW PIN]: ')
                for i in NewPin:
                    if i in digits and len(NewPin) == 4:
                        number += 1
                    else:
                        pass
                if number == 4:
                    print('[PIN UPDATED]')
                    Accountlist.accounts[currentaccount].accountpin = NewPin
                    LoggedIn()

                else:
                    print('[ENTER 4-DIGIT NUMBER]')
                    print('[...]')
                    continue

        else:
            print('[INCORRECT PASSWORD]')
            continue


# A menu that allows the user to check their account balance

def Checkbalance():
    global currentaccount

    print('\n')

    print(f'[YOUR ACCOUNT BALANCE IS [â‚¦{Accountlist.accounts[currentaccount].accountbalance}]]')
    print('[...]')
    LoggedIn()


# A function that allows users to see their transaction history

def Transaction_history():
    counter = 0
    global currentaccount
    global Accountlist

    print('\n')

    if len(Accountlist.accounts[currentaccount].transactions) < 1:
        print('[NO TRANSACTIONS]')
        print('[...]')
        LoggedIn()

    else:
        print("[CURRENT TRANSACTION HISTORY]:")
        for i in Accountlist.accounts[currentaccount].transactions:
            if Accountlist.accounts[currentaccount].transactions[counter].transtype == True:
                print(f'[YOU DEPOSITED [â‚¦{Accountlist.accounts[currentaccount].transactions[counter].amount}]]')
                counter += 1
            elif Accountlist.accounts[currentaccount].transactions[counter].transtype == False:
                print(f'[YOU WITHDREW [â‚¦{Accountlist.accounts[currentaccount].transactions[counter].amount}]]')
                counter += 1
            pass
        LoggedIn()


# A menu that allows you to choose between debit and credit

def MoneyMenu():
    print('\n')

    while True:
        print('...')
        print('Enter D for [DEPOSIT]')
        print('Enter W for [WITHDRAWL]')

        Option = input('[ENTER OPTION]...').capitalize()
        if Option == 'D':
            Deposit()
        elif Option == 'W':
            Withdrawal()
        else:
            print('[INVALID OPTION]')
            continue

    LoggedIn()


# A function that allows you to withdraw an amount of money

def Withdrawal():
    global Accountlist
    global currentaccount

    print('\n')

    while True:
        entered_pin = input("[ENTER PIN]: ")
        if entered_pin == Accountlist.accounts[currentaccount].accountpin:
            print("[PIN VERIFIED]")
            try:
                withdrawal_amount = float(input("[ENTER WITHDRAWL AMOUNT]: "))
            except:
                print('[ENTER A NUMBER]')
                continue
            else:
                if withdrawal_amount <= 0:
                    print("[INVALID AMOUNT. ENTER POSITIVE]")
                    continue
                elif withdrawal_amount > Accountlist.accounts[currentaccount].accountbalance:
                    pros = "Processing......"
                    for i in range(0, len(pros)):
                        print(pros[i], end="")
                        time.sleep(2)
                    print("[INSUFFICENT AMOUNT]")
                    return
                elif withdrawal_amount > 0:
                    Accountlist.accounts[currentaccount].accountbalance -= withdrawal_amount
                    pros="Processing..."
                    for i in range(0,len(pros)):
                        print(pros[i], end="")
                        time.sleep(1)
                    print(f"[WITHDRAWL SUCCESSFUL]")
                    print(f"Amount withdrawn: [â‚¦{withdrawal_amount}]")
                    Withdraw1 = Transactiondetails(withdrawal_amount, False)
                    Accountlist.accounts[currentaccount].save_trans(Withdraw1)

                    print(f"REMAINING BALANCE: [â‚¦{Accountlist.accounts[currentaccount].accountbalance}]")
                    LoggedIn()
        else:
            print("[INCORRECT PIN, ACCESS DENIED]")
            continue


# A function that allows you to deposit an amount of money

def Deposit():
    global Accountlist
    global currentaccount

    print('\n')

    while True:
        entered_pin = input("[ENTER PIN]: ")
        if entered_pin == Accountlist.accounts[currentaccount].accountpin:
            print("[PIN VERIFIED]")
            try:
                deposit_amount = float(input("[ENTER DEPOSIT AMOUNT]: "))
            except:
                print('[ENTER A NUMBER]')
                continue
            else:
                if deposit_amount <= 0:
                    print("[INVALID AMOUT, ENTER POSITVE NUMBER]")
                    continue
                elif deposit_amount > 0:
                    Accountlist.accounts[currentaccount].accountbalance += deposit_amount
                    pros = "Processing...."
                    for i in range(0, len(pros)):
                        print(pros[i], end="")
                        time.sleep(1)
                    print(f"[DEPOSIT SUCCESSFUL]")
                    print(f"AMOUNT DEPOSITED: [â‚¦{deposit_amount}]")
                    Deposit1 = Transactiondetails(deposit_amount, True)
                    Accountlist.accounts[currentaccount].save_trans(Deposit1)
                    print(f"CURRENT BALANCE: [â‚¦{Accountlist.accounts[currentaccount].accountbalance}]")
                    LoggedIn()
        else:
            print("[INCCORECT PIN, ACCESS DENIED]")
            continue


# A function that allows the user to delete their account

def DeleteAcc():
    global currentaccount

    print('\n')

    print('[ENTER PASSWORD]')
    CheckPassword = input('[CONFIRM PASSWORD]: ')
    if CheckPassword == Accountlist.accounts[currentaccount].password:
        del Accountlist.accounts[currentaccount]
        print('[...]')
        print('[...]')
        print('[ACCOUNT DELETED]')
        currentaccount = -1
        print('[RETURNING TO MAIN MENU...]')
        pros = "[....]"
        for i in range(0, len(pros)):
            print(pros[i], end="")
            time.sleep(2)

        UserProgram()


# The developer menu

def ClearAccounts():
    global Accountlist

    print('\n')

    Accountlist.accounts.clear()
    print('[ALL ACCOUNTS CLEARED]')
    print('[...]')

    DevMenu()


Accountlist = Acclist(5)

currentaccount = -1

namehold = 'Null'
passhold = 'Null'
pinhold = '0000'
balancehold = 0

StartMenu()


